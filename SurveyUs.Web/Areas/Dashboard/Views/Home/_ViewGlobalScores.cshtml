

@using Microsoft.AspNetCore.Mvc.TagHelpers
@model List<SurveyUs.Web.Areas.Dashboard.Models.ScoreModel>

<div>
    <select id="globalStoreFilter" class="form-control col-sm-12 col-md-6 offset-md-6">
        <option value="">All Store</option>
        @foreach (var state in Model[0].StoreOptions)
        {
            <option value="@state.State">@state.State</option>
        }
    </select>
</div>

<table class="table table-responsive table-striped" id="globalScoresTable">
    <thead>
        <tr>
            <th>#</th>
            <th>Name</th>
            <th>Store</th>
            <th>Represent As</th>
            <th>Outlet Name</th>
            <th>Score</th>
        </tr>
    </thead>
    <tbody>
        @if (Model[0].State == null)
        {
            Model.Clear();
        }
        @{ int i = 1; }
        @foreach (var score in Model)
        {
            <tr>
                <td>@(i++)</td>
                <td>@score.Name</td>
                <td>@score.State</td>
                <td>@score.RepresentAs</td>
                <td>@score.OutletName</td>
                <td>@score.Score</td>
            </tr>
        }
    </tbody>
</table>

<script>
    $(document).ready(function () {
        var globalTable = $("#globalScoresTable").DataTable({
            drawCallback: function (settings) {
                var api = this.api();
                var startIndex = api.context[0]._iDisplayStart;

                api.column(0, { search: 'applied', order: 'applied' }).nodes().each(function (cell, i) {
                    cell.innerHTML = startIndex + i + 1;
                });
            }
        });

        $("#globalScoresTable_filter.dataTables_filter").append($("#globalStoreFilter"));

        var globalStoreIndex = 0;
        $("#globalScoresTable th").each(function (i) {
            if ($($(this)).html() == "Store") {
                globalStoreIndex = i;
                return false;
            }
        });

        // Function to filter the global scores based on store
        function applyGlobalStoreFilter() {
            var globalSelectedItem = $('#globalStoreFilter').val();

            globalTable.columns().every(function () {
                var column = this;
                if (column.index() === globalStoreIndex) {
                    column.search(globalSelectedItem, true, false);
                }
            });

            globalTable.draw();
        }

        // Apply the global store filter on page load
        applyGlobalStoreFilter();

        // Bind the change event to the global store filter
        $("#globalStoreFilter").change(function () {
            applyGlobalStoreFilter();
        });
    });

</script>