@using Microsoft.AspNetCore.Mvc.TagHelpers
@model IEnumerable<SurveyUs.Web.Areas.Admin.Models.StoreViewModel>

<form id="assign-form" method="post" asp-area="Admin" asp-controller="CampaignSetting" asp-action="OnPostAssignToStore" onsubmit="return jQueryModalPost(this);">
<input type="hidden" name="selectedIds" id="selectedIds" />
<input type="hidden" name="campaignId" value="@ViewBag.CampaignId" />
<table class="table table-striped" id="storeTable">
    <thead>
        <tr>
            <th>
                No.
            </th>
            <th>
                Store
            </th>
            <th>
                State
            </th>
            <th>
                Status
            </th>
            <th style="width:10%;">
                Select
            </th>
        </tr>
    </thead>
    <tbody>
        @{
            var i = 1; 
        }
        @foreach (var store in Model)
        {
            <tr>
                <td>
                    @i
                </td>
                <td>
                    @store.Name
                </td>
                <td>
                    @store.State
                </td>
                <td>
                    @if (store.IsActive)
                    {
                        <span class="badge badge-success">Active</span>
                    }
                    else
                    {
                        <span class="badge badge-danger">Inactive</span>
                    }
                </td>
                <td style="text-align: center">
                    <input class="form-check-input" type="checkbox" name="selected" value="@store.Id">
                </td>
            </tr>
            i++;
        }
    </tbody>
</table>

<div class="form-group justify-content-between" style="margin-bottom: 0px !important">
    <button type="button" id="submitBtn" class="btn btn-success">Save</button>
    <button type="submit" class="btn btn-default close-button" data-dismiss="modal">Cancel</button>
</div>
</form>

<script>
    $(document).ready(function () {
        console.log(@ViewBag.CampaignId);
        $("#storeTable").DataTable(
        {
            searching: true
        });

        $("#submitBtn").click(function () {
            var selectedIds = $('input[name="selected"]:checked').map(function () {
                return parseInt(this.value);
            }).get();
            console.log(selectedIds);

            $("#selectedIds").val(JSON.stringify(selectedIds));
            $("#assign-form").submit();
        });
    });
</script>